<!DOCTYPE html>
<html>

<head>
Weilet's Workshop - C&nbsp;语言下多重嵌套的define    <meta charset="utf-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <meta name="description" content="A blog of a programmer.">
    <meta name="keywords" content="code,game,digital products,daily life">
    <link rel="stylesheet" type="text/css" href="https://weilet.github.io/theme/css/style.css">
</head>

<body>
    <nav class="nav">
        <div class="nav-container">
            <div class="brand">
                <a href="https://weilet.github.io">Weilet's Blog</a>
            </div>
            <div class="links">
                <a class="main-nav-link" href="/archives/">归档</a>
                <a class="main-nav-link" href="/categories/">分类</a>
                <a class="main-nav-link" href="/tags/">标签</a>
                <a class="main-nav-link" href="/index.xml">订阅</a>
            </div>
        </div>
    </nav>
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="https://weilet.github.io/c-语言下多重嵌套的define" rel="bookmark"
         title="Permalink to C 语言下多重嵌套的define">C&nbsp;语言下多重嵌套的define</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2019-04-28T13:47:00+08:00">
      Apr 28, 2019
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="https://weilet.github.io/author/pwnforwhat.html">PwnForWhat</a>
    </address>
    <div class="category">
        Category: <a href="https://weilet.github.io/category/ccpp.html">C&amp;CPP</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>有以下一段宏：</p>
<div class="highlight"><pre><span></span><span class="cp">#define _STR(x) _VAL(x)</span>
<span class="cp">#define _VAL(x) #x</span>
</pre></div>


<p>原以为只是 define _VAL(x) #x 起效果，并不清楚 define _STR(x) _VAL(x)&nbsp;的作用。</p>
<p>因为使用 int x = 5 去测试，发现无论是 _STR() 还是 _VAL() 都是输出&nbsp;x</p>
<p>后来发现，如果改为在顶部添加</p>
<div class="highlight"><pre><span></span><span class="cp">#define x 100</span>
</pre></div>


<p>_STR() 的值为 &#8220;100&#8221; 而 _VAL()的值为&nbsp;&#8220;x&#8221;</p>
<p>由此可以得知，所谓的 define _STR(x) _VAL(x) 用于获取十进制常量的意思，就是获取参数在define时的值（而非赋值操作的值），进而通过 #x&nbsp;转换为字符串量。</p>
<p>最后，附上测试的代码，你可以自行验证：</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#define t 100</span>
<span class="cp">#define _STR(x) _VAL(x)</span>
<span class="cp">#define _VAL(x) #x</span>
<span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">print</span><span class="p">(</span><span class="n">_STR</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="s">&quot;+&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
  </div><!-- /.entry-content -->
</section>
    <footer class="footer container">
        <a class="main-nav-link" href="/blogroll/">友链</a>
        <a class="main-nav-link" href="/about/">关于</a>
    </footer>
</body>

</html>