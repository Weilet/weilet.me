
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://weilet.github.io/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://weilet.github.io/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://weilet.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://weilet.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://weilet.github.io/theme/font-awesome/css/solid.css">




    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">



<meta name="author" content="PwnForWhat" />
<meta name="description" content="安全地使用字典，和安全地使用套套一样重要 Python中的字典数据类型经常被用到，但当我们期待一个不存在的key的value时，它往往会带来一个异常，将我们的程序活生生终结，如何解决？ 最开始的时候 当我们最初接触Python的时候，教学网站上面会跟你提到字典的get …" />
<meta name="keywords" content="">


<meta property="og:site_name" content="Weilet's Workshop"/>
<meta property="og:title" content="如何安全地使用字典"/>
<meta property="og:description" content="安全地使用字典，和安全地使用套套一样重要 Python中的字典数据类型经常被用到，但当我们期待一个不存在的key的value时，它往往会带来一个异常，将我们的程序活生生终结，如何解决？ 最开始的时候 当我们最初接触Python的时候，教学网站上面会跟你提到字典的get …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://weilet.github.io/如何安全地使用字典.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-09-21 23:19:00+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://weilet.github.io/author/pwnforwhat.html">
<meta property="article:section" content="python"/>
<meta property="og:image" content="/images/rick.png">

  <title>Weilet's Workshop &ndash; 如何安全地使用字典</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://weilet.github.io">
        <img src="/images/rick.png" alt="" title="">
      </a>
      <h1><a href="https://weilet.github.io"></a></h1>

<p>Don't be evil</p>
      <nav>
        <ul class="list">

            <li><a target="_blank" href="https://weilet.github.io/pages/about.html#about">About</a></li>
            <li><a target="_blank" href="https://weilet.github.io/pages/contact.html#contact">Contact</a></li>

            <li><a target="_blank" href="http://getpelican.com/" >Pelican</a></li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-github" href="https://weilet.github.io" target="_blank">
            <i class="fab fa-github">
            </i>
          </a></li>
          <li>
            <a  class="sc-rss" href="https://weilet.github.io/feeds/all.rss.xml" target="_blank">
            <i class="fas fa-rss">
            </i>
          </a></li>
      </ul>
    </div>


  </aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="如何安全地使用字典">如何安全地使用字典</h1>
    <p>
          Posted on Sat 21 September 2019 in <a href="https://weilet.github.io/category/python.html">python</a>


    </p>
  </header>


  <div>
    <blockquote>
<p>安全地使用字典，和安全地使用套套一样重要</p>
</blockquote>
<p>Python中的字典数据类型经常被用到，但当我们期待一个不存在的key的value时，它往往会带来一个异常，将我们的程序活生生终结，如何解决？</p>
<h4>最开始的时候</h4>
<p>当我们最初接触Python的时候，教学网站上面会跟你提到字典的get()方法。利用这个方法，可以安全地返回字典的值，如果对应的key不存在，那么它会返回一个默认值，这个<strong>默认值默认是None</strong>，你也可以通过设置default的值改变这个默认值。</p>
<p>需要注意的是，除了get()方法，setdefault()方法同样可以返回默认值，但setdefault()会将不存在的key的项追加到字典中，而get()不会。</p>
<h4>笨拙且安全的</h4>
<p>后来，我们学会了异常处理，于是或多或少出于炫技的目的，使用异常处理来完成这个任务。这个方法适合当出现KeyError，你不仅需要返回默认值，而且还需要做一些处理（不然为什么不使用简单的if-else呢？）</p>
<p>可是，当你多年回来review你的代码，你也许会感叹它的笨拙。</p>
<h4>是时候使用魔法的力量了</h4>
<p>利用魔法方法（特殊方法）__missing__()，当key不存在时，字典会调用这个方法，而非抛出KeyError，很酷炫。</p>
<h4>用些现成的</h4>
<p>鉴于collections中defaultdict的易用性，我向你强烈推荐。</p>
<p>简单地说，它的构造函数接受两个参数，一个是默认值的生成函数（即官方文档中的工厂函数），另一个则是一个字典。通过包装，它成为一个会返回默认值的字典。</p>
<p>这个工厂函数可以是</p>
<ul>
<li>构造函数</li>
<li>返回你生日的函数</li>
<li>…………</li>
</ul>
<p>实际上，它基本没有限制。</p>
<p>举个栗子：</p>
<div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">DevelopmentConfig</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;development&#39;</span><span class="p">:</span> <span class="n">DevelopmentConfig</span><span class="p">(),</span>
    <span class="s1">&#39;production&#39;</span><span class="p">:</span> <span class="n">ProductionConfig</span><span class="p">(),</span>
    <span class="s1">&#39;heroku&#39;</span><span class="p">:</span> <span class="n">HerokuConfig</span><span class="p">(),</span>
    <span class="s1">&#39;docker&#39;</span><span class="p">:</span> <span class="n">DockerConfig</span><span class="p">(),</span>
    <span class="s1">&#39;unix&#39;</span><span class="p">:</span> <span class="n">UnixConfig</span><span class="p">(),</span> 
<span class="p">})</span>
</pre></div>


<blockquote>
<p>最近在读PyDictObject，没准哪天会写一写</p>
</blockquote>
  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>





</article>

    <footer>
<p>
  &copy;   - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Weilet's Workshop ",
  "url" : "https://weilet.github.io",
  "image": "/images/rick.png",
  "description": ""
}
</script>

</body>
</html>